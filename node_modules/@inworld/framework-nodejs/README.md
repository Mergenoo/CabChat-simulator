<div align="center">

# Inworld Node.js Framework

**A powerful and flexible framework for building multimodal agents for games, entertainment and media.**

---

<p align="center">
  <a href="#quick-start">Quick Start</a> •
  <a href="#templates">Templates</a> •
</p>

[![Node.js18](https://img.shields.io/badge/node-18-blue.svg)](https://nodejs.org/en/download/)

</div>

# Quick Start

## Prerequisites

1. Make sure you have Node.js 18 or higher installed.

2. Git large file storage ([LFS](https://git-lfs.com)) is required to clone the repository. It allows to store binary files in the repository.

3. Certain libraries are required for the framework Node.js to work.

- `BLAS`
- `iconv`
- `fontconfig`

4. Some libraries are optional.

- `graphviz`: Install this package if you need to visualize graphs.

## Local models

To download the local models from dvc, follow the instructions in the [Inworld C++ Framework](https://github.com/inworld-ai/inworld-framework-cpp?tab=readme-ov-file#get-local-models).
The models will be downloaded to the `./data` directory of the Node.js framework.

## Environment Variables

- `VERBOSITY`: Enables verbosity level on the framework side. Example values: `0`, `1`, `2`. See VLOG severity.

## Templates

- Because the package is a private one and not published to any npm registry right now, you need to build the framework from source and then run the templates using a link to the local package.
- You need to have a valid environment to run the templates. Copy .env-sample file to .env and fill it with your own values.

### Run CLI templates in development mode

```bash
# Build framework from source from the root directory
yarn install && yarn build

# Create link to local package
yarn link

# Go to the templates directory
cd templates/ts/cli

# Copy .env-sample file to .env and fill it with your own values
cp .env-sample .env

# Install dependencies
yarn install

# Install the framework using link to local package (in development mode)
yarn link @inworld/framework-nodejs

# Run the example
yarn basic-llm "Hello, how are you?"
```

### Run CLI templates in production mode

```bash
# Go to the examples directory
cd templates/ts/cli

# Copy .env_local file to .env and fill it with your own values
cp .env_local .env

# Install dependencies
yarn install

# Install the framework from the package (in production mode) if you have a distribution archive.
yarn add [path-to-dist-directory]/inworld-framework-nodejs-*.tgz

# Run the example
yarn basic-llm "Hello, how are you?"
```

### Run Character Engine

Follow the instuctions provided in [character engine folder](templates/ts/character_engine/README.md).

## Primitives, graph and character engine

Core building blocks of the framework that provide fundamental functionality. These templates demonstrate how to work with individual components.

| Template                                                                                  | Description                                                          |
|-------------------------------------------------------------------------------------------| -------------------------------------------------------------------- |
| [Basic LLM](templates/ts/cli/primitives/basic_llm.ts)                                     | Demonstrates both remote and local LLM usage for text generation     |
| [Basic STT](templates/ts/cli/primitives/basic_stt.ts)                                     | Demonstrates both remote and local STT usage for speech recognition  |
| [Basic TTS](templates/ts/cli/primitives/basic_tts.ts)                                     | Demonstrates both remote and local TTS usage for text to speech      |
| [Basic Memory](templates/ts/cli/primitives/basic_memory.ts)                               | Demonstrates local Memory usage                                      |
| [Basic Knowledge](templates/ts/cli/primitives/basic_knowledge.ts)                         | Demonstrates local Knowledge usage with embedding                    |
| [Basic Remote Knowledge](templates/ts/cli/primitives/basic_remote_knowledge.ts)           | Demonstrates Remote Knowledge API for text records                   |
| [Basic File Knowledge](templates/ts/cli/primitives/basic_file_knowledge.ts)               | Demonstrates Remote Knowledge API with file uploads                  |
| [Basic Knowledge Integration](templates/ts/cli/primitives/basic_knowledge_integration.ts) | Demonstrates comprehensive Knowledge workflow with text and files    |
| [Basic Embedder](templates/ts/cli/primitives/basic_embedder.ts)                           | Demonstrates local Embedder usage                                    |
| [Basic Safety](templates/ts/cli/primitives/basic_safety.ts)                               | Demonstrates content filtering, goal detection and relation analysis |
| [Node LLM](templates/ts/cli/graph/node_llm.ts)                                            | Demonstrates LLM node usage                                          |
| [Node STT](templates/ts/cli/graph/node_llm.ts)                                            | Demonstrates STT node usage                                          |
| [Node TTS](templates/ts/cli/graph/node_llm.ts)                                            | Demonstrates TTS node usage                                          |
| [Node Custom Sync](templates/ts/cli/graph/node_custom_jinja.ts)                           | Demonstrates async custom node                                           |
| [Node Custom Async](templates/ts/cli/graph/node_custom_reverse.ts)                        | Demonstrates sync custom node                                           |
| [Node Custom Text Stream Input](templates/ts/cli/graph/node_custom_llm_stream.ts)         | Demonstrates custom node with text stream input                                          |
| [Node Custom TTS Stream Input](templates/ts/cli/graph/node_custom_tts_stream.ts)          | Demonstrates custom node with tts stream input                                          |
| [Character engine](templates/ts/character_engine)                                         | Demonstrates the basic character engine                              |

# Testing setup

Create a `.env.test` file in the `__tests__` directory and copy the variables from `.env-sample.test` and fill in the values.

# Packaging and distribution

To package the framework for distribution, run the following command:

```bash
# Pack the framework, binaries and templates
yarn release:pack
```

In the `dist` directory, you will find the `inworld-framework-nodejs-*.tgz` file. This file contains the framework itself. In addition,templates are packed into `templates.zip`.

To run the templates, you need to unpack the `templates.zip` file. Then follow the instructions in the [Run CLI templates in production mode](#run-cli-templates-in-production-mode) section.

# Running application with custom binaries

If you need to use custom binaries set `INWORLD_FRAMEWORK_BINARY_PATH` environment variable.

# Documentation

To generate HTML documentation use the following command:

```bash
yarn docs:generate-html
```

This will generate HTML documentation and save it to the `docs_html` folder.
If you need to convert the HTML documentation to MDX one, run:

```bash
yarn docs:generate-mdx
```

To include classes, types, interfaces, and constants in the documentation, make sure to annotate them with TSDoc comments. To exclude any entity from the generated documentation, add the `@internal` tag to its TSDoc comment.

For more details and configuration options, see the [TypeDoc documentation](https://typedoc.org).

# Known issues

**Windows**
If you need to pass environment variables (such as `INWORLD_ENDPOINT`, `INWORLD_HTTP_ENDPOINT`, or `VERBOSITY`) directly to binaries - because it is not expected to be pass them in the source - you can set these variables in PowerShell using the following syntax:

```powershell
$env:INWORLD_ENDPOINT = '<value>'
$env:INWORLD_HTTP_ENDPOINT = '<value>'
$env:VERBOSITY = '<value>'
```
